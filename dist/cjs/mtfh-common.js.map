{"mappings":"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","sources":["lib/mtfh-common.tsx","lib/http/index.ts","lib/http/http.tsx","lib/auth/index.ts","lib/auth/auth.ts","lib/config/index.ts","lib/config/config.ts","lib/http/use-axios-swr/index.ts","lib/http/use-axios-swr/use-axios-swr.ts","lib/components/alert/alert.tsx","lib/components/icon/index.ts","lib/components/icon/icon.tsx","lib/components/spinner/spinner.tsx"],"sourcesContent":["// export { axiosInstance } from './http/http'\n\nexport { axiosInstance, TestButton } from './http'\n// export { Alert, Spinner } from './components'\n\nexport { Alert } from './components/alert/alert'\nexport { Spinner } from './components/spinner/spinner'\n\nexport const Name = \"Callum\"\n","export * from \"./http\";\nexport * from \"./use-axios-swr\";","import axios, { AxiosError, AxiosRequestConfig, CancelTokenSource } from \"axios\";\nimport { v4 as uuid } from \"uuid\";\nimport React from 'react';\n\nimport { $auth, isAuthorised, logout } from \"../auth\";\n\nexport interface Config extends AxiosRequestConfig {\n  headers: Record<string, string>;\n}\n\nexport const axiosInstance = axios.create({\n  responseType: \"json\",\n});\n\nexport const TestButton = () => (\n  <button>Test Button</button>\n)\n\naxiosInstance.interceptors.request.use((reqConfig) => {\n  const req: Config = {\n    ...reqConfig,\n    headers: {\n      ...reqConfig.headers,\n      Authorization: `Bearer ${$auth.getValue().token}`,\n      ...(reqConfig.headers[\"skip-x-correlation-id\"]\n        ? {}\n        : { \"x-correlation-id\": uuid() }),\n    },\n  };\n  delete req.headers[\"skip-x-correlation-id\"];\n\n  if (req.method === \"patch\" && Object.keys(req.data || {}).includes(\"etag\")) {\n    req.headers[\"If-Match\"] = req.data.etag;\n    delete req.data.etag;\n  }\n\n  return req;\n});\n\naxiosInstance.interceptors.response.use(\n  (res) => {\n    if (res.config.method === \"get\" && res.data?.id) {\n      res.data.etag = res.headers.etag;\n    }\n    return res;\n  },\n  (error: AxiosError) => {\n    if (error.response?.status === 403) {\n      if (isAuthorised()) {\n        logout();\n      }\n    }\n    throw error;\n  },\n);\n\nexport const createCancelToken = (): CancelTokenSource => axios.CancelToken.source();\n\nexport const isAxiosError = (e: unknown): e is AxiosError => axios.isAxiosError(e);\n","export * from \"./auth\";\n","import Cookies from \"js-cookie\";\nimport jwtDecode from \"jwt-decode\";\nimport { BehaviorSubject } from \"rxjs\";\n\nimport { config } from \"../config\";\n\nexport interface JWTPayload {\n  sub: string;\n  email: string;\n  iss: string;\n  name: string;\n  groups: string[];\n  iat: number;\n}\n\nexport interface AuthUser extends JWTPayload {\n  token: string;\n}\n\nconst voidUser: AuthUser = {\n  token: \"\",\n  sub: \"\",\n  email: \"\",\n  iss: \"\",\n  name: \"\",\n  groups: [],\n  iat: Number.NaN,\n};\n\nconst parseToken = (): AuthUser => {\n  const token = Cookies.get(config.authToken) || null;\n\n  if (!token) {\n    return voidUser;\n  }\n\n  try {\n    const decodedToken = jwtDecode<JWTPayload>(token);\n    return {\n      ...decodedToken,\n      token,\n    };\n  } catch {\n    return voidUser;\n  }\n};\n\nexport const $auth = new BehaviorSubject(parseToken());\n\nexport const processToken = (): void => {\n  $auth.next(parseToken());\n};\n\nexport const isAuthorisedForGroups = (groups: string[]): boolean => {\n  const auth = $auth.getValue();\n  return groups.some((group) => auth.groups.includes(group));\n};\n\nexport const isAuthorised = (): boolean =>\n  isAuthorisedForGroups(config.authAllowedGroups);\n\nexport const logout = (): void => {\n  $auth.next(voidUser);\n  Cookies.remove(config.authToken, {\n    domain: config.cookieDomain,\n  });\n  window.location.reload();\n};\n\nexport const login = (redirectUrl = `${window.location.origin}/search`): void => {\n  logout();\n  window.location.href = `${config.authDomain}?redirect_uri=${encodeURIComponent(\n    redirectUrl,\n  )}`;\n};\n","export { default as config } from \"./config\";\n","const config = {\n  appEnv: process.env.APP_ENV || \"test\",\n  authAllowedGroups: process.env.AUTH_ALLOWED_GROUPS?.split(\",\") || [\"TEST_GROUP\"],\n  authDomain: process.env.AUTH_DOMAIN || \"//auth.hackney.gov.uk/auth\",\n  cookieDomain: process.env.COOKIE_DOMAIN || \"hackney.gov.uk\",\n  authToken: process.env.AUTH_TOKEN_NAME || \"hackneyToken\",\n  configurationApiUrlV1: process.env.CONFIGURATION_API_URL_V1 || \"\",\n  contactDetailsApiUrlV1: process.env.CONTACT_DETAILS_API_URL_V1 || \"/api/v1\",\n  contactDetailsApiUrlV2: process.env.CONTACT_DETAILS_API_URL_V2 || \"/api/v2\",\n  cautionaryApiUrlV1: process.env.CAUTIONARY_API_URL_V1 || \"/api/v1\",\n  personApiUrlV1: process.env.PERSON_API_URL_V1 || \"/api/v1\",\n  personApiUrlV2: process.env.PERSON_API_URL_V2 || \"/api/v2\",\n  notesApiUrlV1: process.env.NOTES_API_URL_V1 || \"/api/v1\",\n  notesApiUrlV2: process.env.NOTES_API_URL_V2 || \"/api/v2\",\n  tenureApiUrlV1: process.env.TENURE_API_URL_V1 || \"/api/v1\",\n  assetApiUrlV1: process.env.PROPERTY_API_URL_V1 || \"/api/v1\",\n  referenceDataApiUrlV1: process.env.REFERENCE_DATA_API_URL_V1 || \"/api/v1\",\n  addressApiUrlV1: process.env.ADDRESS_API_URL_V1 || \"/api/v1\",\n  addressApiUrlV2: process.env.ADDRESS_API_URL_V2 || \"/api/v2\",\n  equalityInformationApiUrlV1: process.env.EQUALITY_INFORMATION_API_URL_V1 || \"/api/v1\",\n  repairsHubAppUrl: process.env.REPAIRS_HUB_APP_URL || \"/api/v1\",\n  repairsHubApiUrl: process.env.REPAIRS_HUB_API_URL || \"/api/v1\",\n  processApiUrlV1: process.env.PROCESS_API_URL_V1 || \"/api/v1\",\n  processApiUrlV2: process.env.PROCESS_API_URL_V2 || \"/api/v2\",\n};\n\nexport default config;\n","export * from './use-axios-swr';","import { AxiosError, AxiosRequestConfig } from \"axios\";\nimport useSwr, { Key, KeyLoader, SWRConfiguration, SWRResponse, mutate } from \"swr\";\nimport useSWRInfinite, {\n  SWRInfiniteConfiguration,\n  SWRInfiniteResponse,\n} from \"swr/infinite\";\n\nimport { axiosInstance } from \"../http\";\n\nexport type AxiosSWRError = AxiosError;\nexport type AxiosSWRResponse<T> = SWRResponse<T, AxiosSWRError>;\nexport type AxiosSWRInfiniteResponse<T> = SWRInfiniteResponse<T, AxiosSWRError>;\nexport type AxiosSWRConfiguration<T> = SWRConfiguration<T, AxiosError> &\n  AxiosRequestConfig;\nexport type AxiosSWRInfiniteConfiguration<T> = SWRInfiniteConfiguration<\n  T,\n  AxiosSWRError\n> &\n  AxiosRequestConfig;\n\nexport const axiosFetcher =\n  (options: AxiosRequestConfig = {}) =>\n  <ResponseData>(url: string): Promise<ResponseData> =>\n    axiosInstance.get<ResponseData>(url, options).then((res) => res.data);\n\nexport const useAxiosSWR = <ResponseData>(\n  key: Key,\n  options: AxiosSWRConfiguration<ResponseData> = {},\n): AxiosSWRResponse<ResponseData> =>\n  useSwr<ResponseData, AxiosSWRError>(key, axiosFetcher(options), {\n    shouldRetryOnError: false,\n    ...options,\n  });\n\nexport const useAxiosSWRInfinite = <ResponseData>(\n  key: KeyLoader<ResponseData>,\n  options: AxiosSWRInfiniteConfiguration<ResponseData> = {},\n): AxiosSWRInfiniteResponse<ResponseData> =>\n  useSWRInfinite<ResponseData, AxiosSWRError>(key, axiosFetcher(options), options);\n\nexport { mutate };\n","import React, { forwardRef } from \"react\";\n\nimport { Icon, IconProps } from \"../icon\";\n\nexport const Alert = forwardRef<SVGSVGElement, IconProps>(function Spinner(\n  { size = \"24\", ...props },\n  ref,\n) {\n  return (\n    <Icon ref={ref} size={size} {...props}>\n      <path\n        d=\"M16.5 42.6212C18.7688 42.6212 20.625 40.7605 20.625 38.4863H12.375C12.375 40.7605 14.2312 42.6212 16.5 42.6212Z\"\n        fill=\"#BE3A34\"\n      />\n      <path\n        d=\"M28.875 30.2225V19.8849C28.875 13.5376 25.5131 8.22412 19.5938 6.81821V5.4123C19.5938 3.69627 18.2119 2.31104 16.5 2.31104C14.7881 2.31104 13.4062 3.69627 13.4062 5.4123V6.81821C7.5075 8.22412 4.125 13.517 4.125 19.8849V30.2225L0 34.3575V36.425H33V34.3575L31.1268 32.4797L28.875 30.2225Z\"\n        fill=\"#BE3A34\"\n      />\n      <path\n        d=\"M17.5808 25.7373H15.4363L14.988 17.1504H18.0291L17.5808 25.7373ZM14.9529 28.7432C14.9529 28.1924 15.1023 27.8057 15.4011 27.583C15.7058 27.3604 16.072 27.249 16.4998 27.249C16.9158 27.249 17.2732 27.3604 17.572 27.583C17.8767 27.8057 18.0291 28.1924 18.0291 28.7432C18.0291 29.2705 17.8767 29.6514 17.572 29.8857C17.2732 30.1201 16.9158 30.2373 16.4998 30.2373C16.072 30.2373 15.7058 30.1201 15.4011 29.8857C15.1023 29.6514 14.9529 29.2705 14.9529 28.7432Z\"\n        fill=\"white\"\n      />\n    </Icon>\n  );\n});\n","export * from \"./icon\";\n","import React, { ComponentPropsWithoutRef, forwardRef } from \"react\";\n\nimport cn from \"classnames\";\n\nimport \"./styles.scss\";\n\nexport interface IconProps extends ComponentPropsWithoutRef<\"svg\"> {\n  viewBox: string;\n  size?: string;\n  color?: string;\n}\n\nexport const Icon = forwardRef<SVGSVGElement, IconProps>(function Icon(\n  { width, height, color, className, size = \"1em\", focusable = false, ...props },\n  ref,\n) {\n  const iconClasses = cn(\"mtfh-icon\", className);\n\n  const style: Record<string, string | number> = {};\n\n  if (color && color !== \"currentColor\") {\n    style.color = color;\n  }\n\n  return (\n    <svg\n      ref={ref}\n      className={iconClasses}\n      width={width || size}\n      height={height || size}\n      focusable={focusable}\n      style={style}\n      {...props}\n    />\n  );\n});\n","import React, { forwardRef } from \"react\";\n\nimport { Icon, IconProps } from \"../icon\";\n\ninterface SpinnerProps extends Omit<IconProps, \"viewBox\"> {\n  label?: string;\n}\n\nexport const Spinner = forwardRef<SVGSVGElement, SpinnerProps>(function Spinner(\n  { size = \"50\", label = \"Loading...\", ...props },\n  ref,\n) {\n  return (\n    <Icon ref={ref} viewBox=\"0 0 42 42\" stroke=\"#00703c\" size={size} {...props}>\n      <title>{label}</title>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <g transform=\"translate(3 3)\" strokeWidth=\"5\">\n          <circle strokeOpacity=\".5\" cx=\"18\" cy=\"18\" r=\"18\" />\n          <path d=\"M36 18c0-9.94-8.06-18-18-18\" transform=\"rotate(112.708 18 18)\">\n            <animateTransform\n              attributeName=\"transform\"\n              type=\"rotate\"\n              from=\"0 18 18\"\n              to=\"360 18 18\"\n              dur=\"1s\"\n              repeatCount=\"indefinite\"\n            />\n          </path>\n        </g>\n      </g>\n    </Icon>\n  );\n});\n"],"names":[],"version":3,"file":"mtfh-common.js.map"}